for (int i=0; i<IP; ++i)
{
  double F = 0.0;
  for (int r=0; r<T; ++r)
  {
    F += (w[r]*X[i][r]);
  }
  for (int j  = 0; j<T; ++j)
  {
    for (int k=0; k<T; ++k)
    {
      A[j][k] += B[i][j]*C[i][k] + (B[i][j]*D[i][k])*F;
    }
  }
}
